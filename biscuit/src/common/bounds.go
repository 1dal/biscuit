package common

import "fmt"
import "runtime"
import "time"

func KMemres(c int, n string) {
	for !runtime.Memreserve(c) {
		fmt.Printf("%v: wait for memory...\n", n)
		time.Sleep(1)
	}
}

func KMemunres() {
	runtime.Memunres()
}

type Boundkey_t int

const (
	B_SYS_PAUSE Boundkey_t = iota
	B_SYS_PREAD
	B_USERBUF_T__TX
	B_TCPFOPS_T_READ
	B_SYS_POLL
	B_SYS_WRITEV
	B_SYS_PROF
	B_USERIOVEC_T__TX
	B_IMEMNODE_T__DESCAN
	B_SYS_TRUNCATE
	B_SYS_SOCKET
	B_SYS_BIND
	B_SYS_CHDIR
	B_PROC_T_K2USER_INNER
	B_RAWDFOPS_T_WRITE
	B_RAWDFOPS_T_READ
	B_IMEMNODE_T_DO_WRITE
	B_IMEMNODE_T_IWRITE
	B_SYS_READV
	B_SYS_SENDTO
	B_SYS_RECVFROM
	B_SYS_SETRLIMIT
	B_INSERTARGS
	B_SYS_WRITE
	B_SYS_GETCWD
	B_TCPTIMERS_T__TCPTIMERS_DAEMON
	B_SYS_SOCKETPAIR
	B_SYS_LINK
	B_SYS_MKNOD
	B_SYS_GETTID
	B_PROC_T_USERARGS
	B_SYS_UNLINK
	B_SYS_REBOOT
	B_KBD_DAEMON
	B_SYS_FSTAT
	B_SYS_MUNMAP
	B_SYS_RECVMSG
	B_SYS_FCNTL
	B_SYS_RENAME
	B_ELF_T_ELF_LOAD
	B_SYS_FTRUNCATE
	B_SYS_NANOSLEEP
	B_SYS_PIPE2
	B_SYS_STAT
	B_SYS_LSEEK
	B_SYS_CONNECT
	B_SYS_SENDMSG
	B_SYS_GETSOCKOPT
	B_SYS_INFO
	B_PROC_T_USER2K_INNER
	B_TCPFOPS_T_WRITE
	B_SYS_GETTIMEOFDAY
	B_SYS_GETRUSAGE
	B_SYS_PWRITE
	B_FS_T__FULLPATH
	B_IMEMNODE_T_IREAD
	B_ARP_RESOLVE
	B_IMEMNODE_T_IMMAPINFO
	B_PIPE_T_OP_FDADD
	B_SYS_ACCESS
	B_SYS_LISTEN
	B_SYS_EXECV
	B_SYS_GETRLIMIT
	B_SYS_SYNC
	B_FUTEX_T_FUTEX_START
	B_SYS_MKDIR
	B_SYS_KILL
	B_SYS_FUTEX
	B_USERIOVEC_T_IOV_INIT
	B_SYS_OPEN
	B_SYS_MMAP
	B_SYS_DUP2
	B_SYS_ACCEPT
	B_SYS_SHUTDOWN
	B_FS_T__ISANCESTOR
	B_PIPEFOPS_T_WRITE
	B_SYS_GETPID
	B_SYS_READ
	B_SYS_THREXIT
	B_FS_T_FS_RENAME
	B_FS_T_FS_NAMEI
	B_IMEMNODE_T_BMAPFILL
	B_SYS_SIGACTION
	B_SYS_GETPPID
	B_SYS_SETSOCKOPT
	B_SYS_FORK
	B_SYS_WAIT4
	B_SYSCALL_T_SYS_CLOSE
	B_SYSCALL_T_SYS_EXIT
)

func Bounds(k Boundkey_t) int {
	if b, ok := bounds[k]; ok {
		return b
	}
	panic("bad bound")
}

var bounds = map[Boundkey_t]int{
	B_SYS_PAUSE:                     0,
	B_SYS_PREAD:                     96*24 + 1*4096 + 1*20 + 97*16 + 100*32 + 289*40 + 105*96 + 3*208 + 98*48 + 1*112 + 2*64 + 108*80,
	B_USERBUF_T__TX:                 97*40 + 33*16 + 34*32 + 35*96 + 32*24 + 1*4096 + 1*208 + 36*80 + 34*48 + 2*64 + 1*20,
	B_TCPFOPS_T_READ:                4*208 + 140*96 + 144*80 + 385*40 + 1*20 + 131*32 + 130*48 + 129*16 + 128*24 + 1*4096 + 2*64,
	B_SYS_POLL:                      (1024)*240 + (512)*32 + 66*32 + 1*4096 + 70*96 + 67*48 + 1*4120 + 193*40 + 72*80 + 2*208 + 2*64 + 65*24 + 65*16 + 1*20,
	B_SYS_WRITEV:                    1*4120 + 1*4096 + 2*64 + 258*48 + 770*40 + 280*96 + 289*80 + 257*16 + 1*20 + 257*24 + 1*184 + 259*32 + 8*208,
	B_SYS_PROF:                      1*48 + 64*1048 + 1*536 + 1*64 + 66*16 + 1*65536 + 2*32792,
	B_USERIOVEC_T__TX:               193*40 + 67*32 + 2*64 + 1*20 + 66*48 + 65*16 + 64*24 + 2*208 + 72*80 + 70*96 + 1*4096,
	B_IMEMNODE_T__DESCAN:            189*64 + 21*96 + 19*16 + 21*80 + 1*20 + 54*40 + 19*24 + 20*32 + 1*4096 + 20*48,
	B_SYS_TRUNCATE:                  6*208 + 469*16 + 1*8 + 1*20 + 2*1 + 283*48 + 314*80 + 280*32 + 308*96 + 751*64 + 280*24 + 834*40 + 1*4096,
	B_SYS_SOCKET:                    1*16 + 1*576 + 1*24 + 1*4120 + 1*144 + 2*56,
	B_SYS_BIND:                      214*24 + 238*96 + 2*104 + 2*8 + 403*16 + 1*56 + 1*1248 + 1*280 + 214*48 + 215*32 + 1*16408 + 1*11288 + 642*40 + 749*64 + 4*208 + 1*184 + 242*80,
	B_SYS_CHDIR:                     738*40 + 2*1 + 751*64 + 251*48 + 278*80 + 273*96 + 1*8 + 1*4096 + 1*20 + 248*32 + 437*16 + 248*24 + 5*208,
	B_PROC_T_K2USER_INNER:           97*40 + 36*80 + 34*32 + 35*96 + 1*4096 + 1*208 + 34*48 + 33*16 + 32*24 + 2*64 + 1*20,
	B_RAWDFOPS_T_WRITE:              72*96 + 2*208 + 67*24 + 2*64 + 1*20 + 74*80 + 202*40 + 68*16 + 69*48 + 70*32 + 1*4096,
	B_RAWDFOPS_T_READ:               72*96 + 67*16 + 1*20 + 2*208 + 69*32 + 68*48 + 1*4096 + 2*64 + 66*24 + 74*80 + 199*40,
	B_IMEMNODE_T_DO_WRITE:           84*24 + 94*96 + 95*80 + 2*64 + 1*20 + 1*4096 + 253*40 + 2*208 + 87*48 + 87*32 + 85*16,
	B_IMEMNODE_T_IWRITE:             93*80 + 2*208 + 2*64 + 1*20 + 82*24 + 84*48 + 85*32 + 247*40 + 1*4096 + 92*96 + 83*16,
	B_SYS_READV:                     290*48 + 1*1024 + 4*25 + 324*80 + 288*24 + 9*208 + 2*64 + 1*4120 + 866*40 + 1*4096 + 1*184 + 1*20 + 289*16 + 315*96 + 291*32,
	B_SYS_SENDTO:                    4*8 + 1*16408 + 243*80 + 218*24 + 4*104 + 220*16 + 654*40 + 220*32 + 187*64 + 7*208 + 236*96 + 1*11288 + 218*48 + 1*280,
	B_SYS_RECVFROM:                  1*16408 + 290*32 + 290*16 + 288*48 + 864*40 + 4*8 + 9*208 + 315*96 + 1*11288 + 1*4120 + 4*104 + 288*24 + 324*80,
	B_SYS_SETRLIMIT:                 193*40 + 72*80 + 66*48 + 70*96 + 1*4096 + 1*20 + 2*208 + 64*24 + 65*16 + 66*32 + 2*64,
	B_INSERTARGS:                    64*1560 + 1*1 + 2*208 + 1*280 + 1*536 + 66*48 + 70*96 + 66*32 + 2*64 + 72*80 + 1*112 + 65*16 + 193*40 + 129*24 + 1*4096 + 1*20,
	B_SYS_WRITE:                     140*96 + 128*48 + 1*16408 + 4*208 + 2*104 + 2*8 + 145*80 + 1*11288 + 130*16 + 129*24 + 129*32 + 384*40,
	B_SYS_GETCWD:                    119*16 + 348*40 + 1*4096 + 3*1 + 132*80 + 119*32 + 118*48 + 4*208 + 128*96 + 377*64 + 1*8 + 117*24 + 1*20,
	B_TCPTIMERS_T__TCPTIMERS_DAEMON: 360*32 + 1*48 + 1*24 + 360*8 + 2*56 + 1*144,
	B_SYS_SOCKETPAIR:                1*4096 + 2*4120 + 140*96 + 385*40 + 2*184 + 4*56 + 130*32 + 129*16 + 130*48 + 1*20 + 134*24 + 4*64 + 144*80 + 4*208,
	B_SYS_LINK:                      751*64 + 366*96 + 338*24 + 1*20 + 1*8 + 2*1 + 1008*40 + 338*32 + 525*16 + 9*208 + 375*80 + 339*48 + 1*4096,
	B_SYS_MKNOD:                     5*208 + 250*48 + 1*8 + 273*96 + 2*1 + 437*16 + 751*64 + 247*24 + 278*80 + 248*32 + 738*40 + 1*4096 + 1*20,
	B_SYS_GETTID:                    0,
	B_PROC_T_USERARGS:               3*208 + 105*96 + 98*16 + 289*40 + 97*24 + 108*80 + 9*1 + 2*64 + 1*20 + 1*1048 + 1*4096 + 3*8 + 98*48 + 107*32,
	B_SYS_UNLINK:                    937*64 + 254*96 + 233*48 + 5*208 + 235*16 + 232*32 + 1*8 + 1*4096 + 1*20 + 259*80 + 690*40 + 232*24 + 2*1,
	B_SYS_REBOOT:                    0,
	B_KBD_DAEMON:                    1*16 + 1*1024 + 1*24 + 1*32 + 4*25 + 1*1,
	B_SYS_FSTAT:                     1*4096 + 49*96 + 48*32 + 2*208 + 1*72 + 48*48 + 139*40 + 2*64 + 1*20 + 47*16 + 46*24 + 51*80,
	B_SYS_MUNMAP:                    1*112 + 1*80 + 2*56 + 1*144,
	B_SYS_RECVMSG:                   864*24 + 1*184 + 1*4096 + 1*4120 + 27*208 + 866*16 + 2*174 + 2*64 + 2594*40 + 945*96 + 972*80 + 866*48 + 869*32 + 1*20,
	B_SYS_FCNTL:                     0,
	B_SYS_RENAME:                    1809*16 + 975*96 + 1*20 + 874*32 + 12*208 + 987*80 + 5*8 + 2*1 + 3370*64 + 4*56 + 1*4096 + 873*48 + 873*24 + 2610*40,
	B_ELF_T_ELF_LOAD:                1*4096 + 4*112 + 144*80 + 385*40 + 4*208 + 130*32 + 1*504 + 140*96 + 131*48 + 129*16 + 132*24 + 2*64 + 1*20,
	B_SYS_FTRUNCATE:                 1*20 + 36*80 + 32*24 + 35*32 + 35*96 + 1*4096 + 2*64 + 33*16 + 96*40 + 34*48 + 1*208,
	B_SYS_NANOSLEEP:                 140*96 + 4*208 + 1*4096 + 2*64 + 385*40 + 128*24 + 144*80 + 130*32 + 1*20 + 131*48 + 129*16,
	B_SYS_PIPE2:                     1*184 + 1*4096 + 129*16 + 1*20 + 132*24 + 385*40 + 140*96 + 2*56 + 4*208 + 2*4120 + 130*48 + 144*80 + 130*32 + 2*64,
	B_SYS_STAT:                      157*32 + 1*8 + 166*96 + 189*64 + 1*4096 + 1*20 + 5*208 + 2*1 + 171*80 + 1*72 + 462*40 + 156*48 + 157*16 + 156*24,
	B_SYS_LSEEK:                     18*16 + 1*208 + 17*48 + 1*72 + 2*8 + 2*64 + 42*40 + 16*32 + 16*80 + 14*96 + 15*24 + 6*104 + 1*20,
	B_SYS_CONNECT:                   90*48 + 99*80 + 187*64 + 91*32 + 2*56 + 92*16 + 2*104 + 1*280 + 1*11288 + 3*208 + 92*24 + 1*184 + 2*8 + 270*40 + 96*96 + 1*16408,
	B_SYS_SENDMSG:                   831*96 + 1*280 + 855*80 + 1*88 + 2*1 + 764*24 + 1*184 + 24*208 + 767*32 + 1*8 + 1*4096 + 1*20 + 764*48 + 2287*40 + 189*64 + 1*72 + 765*16,
	B_SYS_GETSOCKOPT:                481*40 + 175*96 + 5*208 + 2*64 + 163*32 + 161*16 + 180*80 + 162*48 + 1*8 + 1*4096 + 1*20 + 160*24,
	B_SYS_INFO:                      1*32 + 1*5776,
	B_PROC_T_USER2K_INNER:           35*96 + 36*80 + 1*208 + 34*32 + 32*24 + 2*64 + 97*40 + 33*16 + 1*4096 + 1*20 + 34*48,
	B_TCPFOPS_T_WRITE:               385*40 + 130*48 + 129*16 + 128*24 + 4*208 + 2*64 + 1*20 + 144*80 + 140*96 + 1*4096 + 131*32,
	B_SYS_GETTIMEOFDAY:              34*32 + 32*24 + 2*64 + 1*4096 + 1*20 + 98*40 + 33*16 + 36*80 + 1*208 + 34*48 + 35*96,
	B_SYS_GETRUSAGE:                 33*16 + 35*96 + 33*24 + 36*80 + 1*56 + 34*48 + 1*4096 + 2*64 + 1*20 + 34*32 + 1*208 + 97*40,
	B_SYS_PWRITE:                    2*64 + 295*40 + 101*48 + 108*96 + 99*16 + 3*208 + 1*4096 + 1*20 + 102*32 + 98*24 + 110*80,
	B_FS_T__FULLPATH:                58*96 + 377*64 + 55*16 + 2*208 + 2*1 + 1*4096 + 53*24 + 60*80 + 156*40 + 1*8 + 1*20 + 54*32 + 54*48,
	B_IMEMNODE_T_IREAD:              1*112 + 83*16 + 247*40 + 1*4096 + 2*208 + 85*32 + 84*48 + 93*80 + 2*64 + 1*20 + 82*24 + 91*96,
	B_ARP_RESOLVE:                   1*24 + 1*6 + 1*48 + 1*32 + 2*8 + 1*8216 + 1*42,
	B_IMEMNODE_T_IMMAPINFO:          18*24 + 20*48 + 1*20 + 21*96 + 20*32 + 21*80 + 19*16 + 55*40 + 1*4096 + 2*64,
	B_PIPE_T_OP_FDADD:               1 * 80,
	B_SYS_ACCESS:                    437*16 + 2*1 + 1*4096 + 738*40 + 751*64 + 5*208 + 273*96 + 278*80 + 250*48 + 1*8 + 1*20 + 248*32 + 247*24,
	B_SYS_LISTEN:                    2*4120 + 1*136 + 1*56 + 1*75776,
	B_SYS_EXECV:                     4*8 + 1*1 + 1*536 + 751*64 + 665*48 + 728*96 + 1*56 + 746*80 + 1*512 + 1989*40 + 64*1560 + 664*32 + 18*208 + 1*280 + 1*4096 + 735*24 + 1*1048 + 7*112 + 850*16 + 1*20,
	B_SYS_GETRLIMIT:                 128*24 + 130*48 + 385*40 + 140*96 + 1*4096 + 2*64 + 1*20 + 129*16 + 144*80 + 130*32 + 4*208,
	B_SYS_SYNC:                      0,
	B_FUTEX_T_FUTEX_START:           1331*24 + 4*424 + 1440*80 + 1400*96 + 3841*40 + 2*232 + 4*104 + 20*112 + 40*208 + 1*64 + 1281*48 + 1280*32 + 1*8 + 1280*16,
	B_SYS_MKDIR:                     369*32 + 5*208 + 1098*40 + 369*48 + 1*8 + 2*1 + 416*80 + 1314*64 + 928*16 + 367*24 + 411*96 + 1*4096 + 1*20,
	B_SYS_KILL:                      0,
	B_SYS_FUTEX:                     144*80 + 129*16 + 1*4096 + 12*104 + 133*48 + 2*64 + 3*8 + 388*40 + 1*232 + 12*424 + 1*20 + 4*208 + 136*24 + 130*32 + 140*96,
	B_USERIOVEC_T_IOV_INIT:          4*208 + 1*184 + 1*4096 + 385*40 + 130*32 + 140*96 + 129*16 + 130*48 + 2*64 + 1*20 + 128*24 + 144*80,
	B_SYS_OPEN:                      437*16 + 278*80 + 5*208 + 273*96 + 2*1 + 1*4096 + 248*32 + 751*64 + 738*40 + 251*48 + 248*24 + 1*4120 + 1*8 + 1*20,
	B_SYS_MMAP:                      1*24 + 2*112 + 1*80 + 2*56 + 1*144,
	B_SYS_DUP2:                      1*24 + 2*56 + 1*144,
	B_SYS_ACCEPT:                    161*32 + 5*208 + 163*16 + 2*8 + 1*11288 + 1*16408 + 180*80 + 175*96 + 1*4120 + 2*104 + 160*48 + 480*40 + 161*24,
	B_SYS_SHUTDOWN:                  2*56 + 1*144,
	B_FS_T__ISANCESTOR:              48*48 + 189*64 + 48*32 + 49*16 + 1*4096 + 51*80 + 47*24 + 138*40 + 49*96 + 2*208 + 2*1 + 1*8 + 1*20,
	B_PIPEFOPS_T_WRITE:              4*208 + 129*16 + 1*4096 + 1*20 + 144*80 + 130*48 + 128*24 + 131*32 + 140*96 + 385*40 + 2*64,
	B_SYS_GETPID:                    0,
	B_SYS_READ:                      162*16 + 2*104 + 480*40 + 161*32 + 1*4120 + 1*11288 + 1*16408 + 5*208 + 175*96 + 160*24 + 180*80 + 160*48 + 2*8,
	B_SYS_THREXIT:                   1*24 + 1*8 + 2*56 + 1*144,
	B_FS_T_FS_RENAME:                2226*40 + 1681*16 + 1*20 + 8*208 + 745*48 + 3370*64 + 2*1 + 1*4096 + 5*8 + 843*80 + 746*32 + 835*96 + 745*24 + 4*56,
	B_FS_T_FS_NAMEI:                 49*96 + 189*64 + 1*8 + 1*4096 + 1*20 + 48*32 + 2*1 + 51*80 + 138*40 + 2*208 + 48*24 + 48*48 + 49*16,
	B_IMEMNODE_T_BMAPFILL:           18*32 + 19*96 + 1*20 + 16*24 + 19*80 + 1*4096 + 2*64 + 17*16 + 18*48 + 48*40,
	B_SYS_SIGACTION:                 0,
	B_SYS_GETPPID:                   0,
	B_SYS_SETSOCKOPT:                1*20 + 64*24 + 2*208 + 65*16 + 72*80 + 66*48 + 67*32 + 70*96 + 193*40 + 1*4096 + 2*64,
	B_SYS_FORK:                      512*2*24 + 512*2*112 + 512*24 + 1*208 + 36*80 + 1*4096 + 3*56 + 1*360 + 34*32 + 2*64 + 97*40 + 35*96 + 1*192 + 1*16384 + 2*8 + 1*20 + 34*48 + 32*24 + 3*1 + 33*16 + 1*4120,
	B_SYS_WAIT4:                     96*24 + 99*48 + 105*96 + 1*56 + 1*4096 + 2*64 + 98*32 + 3*208 + 97*16 + 289*40 + 108*80 + 1*20,
	B_SYSCALL_T_SYS_CLOSE:           2*56 + 1*144,
	B_SYSCALL_T_SYS_EXIT:            1*24 + 1*8 + 2*56 + 1*144,
}
